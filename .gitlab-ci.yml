variables:
  DOCKER_DRIVER: overlay2
  DOCKER_HOST: tcp://10.0.23.72:2375/
  DOCKER_BUILDKIT: 1
  CI_REGISTRY_IMAGE: code.nap.av.it.pt:5050/mobility-networks/vanetza

build:
  stage: build
  image: carlallen/docker:buildx
  before_script:
    - docker buildx use builder
    - docker login -u vanetza-ci -p $CI_TOKEN code.nap.av.it.pt:5050
  script: |
    docker buildx build \
          --platform=linux/amd64,linux/arm64,linux/armhf \
          --cache-from type=registry,ref=$CI_REGISTRY_IMAGE:cache \
          --cache-to type=registry,ref=$CI_REGISTRY_IMAGE:cache \
          --push \
          --tag $CI_REGISTRY_IMAGE:latest \
          .
